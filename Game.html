<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>

    <style type="text/css">
        .gem {
            height: 30px;
            width: 30px;
            border-radius: 10px;
            display: inline-block;
        }

        .gem.gem-red {
            background-color: red;
        }

        .gem.gem-green {
            background-color: green;
        }

        .gem.gem-blue {
            background-color: blue;
        }

        .game-field {
            height: 302px;
            width: 302px;
            border-style: solid;
        }

        .selected {
            border-color: black;
            border-width: 2px;
            border-style: solid;
            width: 26px;
            height: 26px;
        }
    </style>

    <script src="./js/jquery-2.2.4.min.js"></script>

</head>
<body>

<div class="game-field">
    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>

    <span class="gem gem-red"></span>
    <span class="gem gem-green"></span>
    <span class="gem gem-blue"></span>
</div>

<script>
    var selectedGem = null;

    function swapClassNames(lefElement, rightElement) {
        var thisClassName = $(lefElement).attr("class");
        $(lefElement).attr("class", $(rightElement).attr("class"));
        $(rightElement).attr("class", thisClassName);
    }

    function deselectGem(gem) {
        $(gem).removeClass("selected");
        selectedGem = null;
    }
    function isSelected(gem) {
        return selectedGem === gem;
    }
    function someGemIsSelected() {
        return selectedGem !== null;
    }
    function swapGemWithSelected(gem) {
        swapClassNames(gem, selectedGem);
        deselectGem(gem);
    }
    function selectGem(gem) {
        $(gem).addClass("selected");
        selectedGem = gem;
    }
    $(".gem").click(function () {
        var clickedGem = this;

        if (isSelected(clickedGem)) {
            deselectGem(clickedGem);
        } else {
            if (someGemIsSelected()) {
                var clickedGemColumn = ($(clickedGem).offset().left - 11) / 34;
                var clickedGemRow = ($(clickedGem).offset().top - 11) / 34;
                var selectedGemColumn = ($(selectedGem).offset().left - 11) / 34;
                var selectedGemRow = ($(selectedGem).offset().top - 11) / 34;

                if (Math.abs(clickedGemColumn - selectedGemColumn) + Math.abs(clickedGemRow - selectedGemRow) === 1 ) {
                    swapGemWithSelected(clickedGem);
                } else {
                   deselectGem(selectedGem);
                }

            } else {
                selectGem(clickedGem);
            }
        }
    })
</script>
</body>
</html>